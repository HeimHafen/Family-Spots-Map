/* =========================================
   theme.css — Light & Dark Design Tokens
   Playful Warm v2.4 (Design-System Level)
   - deterministische Token-Struktur via Cascade Layers
   - CTA-Kontrast sauber: --accent-solid + --on-accent-solid
   - semantische Text-Rollen (Headings / Body / Muted) konsistent
   - Legacy/Component Tokens bleiben kompatibel
   - robustes Theme-Targeting: :root/html/body + optional container [data-theme]
   - NEW: zusätzliche “Flat”-Background Tokens (für Fallbacks / iOS / Meta)
   ========================================= */

@layer tokens, base, overrides;

/* =========================================================
   BASE — Theme plumbing (kein “Look”, nur System)
   ========================================================= */
@layer base {
  :root {
    color-scheme: light;
  }

  :where(:root, html, body)[data-theme="light"] {
    color-scheme: light;
  }

  :where(:root, html, body)[data-theme="dark"],
  [data-theme="dark"] {
    color-scheme: dark;
  }
}

/* =========================================================
   TOKENS — Default (Light)
   ========================================================= */
@layer tokens {
  :root {
    /* ----------------------------
       Cache / Debug Token (harmlos)
       ---------------------------- */
    --theme-version: 20251222;

    /* ================================
       Brand / Accent System (warm, AA-friendly)
       ================================ */
    --accent-h: 30;

    /* Accent (general) */
    --accent: hsl(var(--accent-h) 74% 48%);
    --accent-light: hsl(var(--accent-h) 72% 58%);
    --accent-dark: hsl(var(--accent-h) 78% 34%);

    /* Solid accent for CTAs (AA-kontrastfähig zu weißem Text) */
    --accent-solid: hsl(var(--accent-h) 78% 39%);
    --accent-solid-dark: hsl(var(--accent-h) 80% 32%);
    --accent-solid-light: hsl(var(--accent-h) 76% 46%);
    --on-accent-solid: #ffffff;

    /* Accent surfaces (soft warmth) */
    --accent-soft: hsla(var(--accent-h) 78% 52% / 0.16);
    --accent-soft-hover: hsla(var(--accent-h) 78% 52% / 0.22);
    --accent-strong: hsl(var(--accent-h) 70% 40%);

    /* “On-*” tokens */
    --on-accent: hsl(24 55% 12%);
    --on-dark: hsl(32 100% 95%);
    --on-light: hsl(222 47% 11%);

    /* ================================
       Semantic Text Tokens (wärmere “Tinte”)
       ================================ */
    --text-3: hsl(22 58% 12%); /* headings / strongest */
    --text-1: hsl(24 46% 16%); /* body */
    --text-2: hsl(24 22% 34%); /* muted */

    /* Text roles */
    --text-heading: var(--text-3);
    --text-body: var(--text-1);
    --text-muted: var(--text-2);

    /* Optional roles (helpful for fine-tuning across files) */
    --text-soft: color-mix(in oklab, var(--text-body) 78%, transparent);
    --text-strong: var(--text-heading);

    /* Placeholder (optional use) */
    --placeholder-color: color-mix(in oklab, var(--text-muted) 92%, transparent);

    /* ================================
       Surfaces (Light: warm paper)
       ================================ */
    --surface-0: hsl(38 70% 97%);
    --surface-1: hsla(38 70% 92% / 0.98);
    --surface-2: hsla(38 66% 89% / 0.98);
    --surface-3: hsla(37 60% 86% / 0.98);

    /* Borders */
    --border-1: hsla(30 30% 18% / 0.16);
    --border-2: hsla(30 30% 18% / 0.24);

    /* Elevation */
    --elev-1: 0 1px 2px hsla(26 35% 18% / 0.10);
    --elev-2: 0 10px 26px hsla(26 40% 18% / 0.16);
    --elev-3: 0 18px 54px hsla(26 45% 18% / 0.20);

    /* Radii / Motion / Typography */
    --radius-pill: 999px;
    --border-radius: 0.5rem;

    --transition-fast: 150ms ease;
    --dur-fast: 120ms;
    --dur: 160ms;
    --dur-slow: 220ms;
    --ease-out: cubic-bezier(0.2, 0.8, 0.2, 1);

    --font-stack: "Segoe UI", Roboto, system-ui, -apple-system, sans-serif;
    --font-size-base: 1rem;

    /* Focus ring */
    --focus-inner: rgba(255, 255, 255, 0.92);
    --focus-outer: hsla(var(--accent-h) 78% 44% / 0.42);
    --focus-ring: 0 0 0 2px var(--focus-inner), 0 0 0 5px var(--focus-outer);

    /* Some files expect a default ring token name */
    --focus-ring-default: var(--focus-ring);

    /* ================================
       Backgrounds / Effects
       ================================ */
    --bg-app:
      radial-gradient(circle at 18% 0%, hsla(var(--accent-h) 78% 56% / 0.16), transparent 58%),
      radial-gradient(circle at 88% 22%, hsla(42 78% 62% / 0.10), transparent 54%),
      linear-gradient(180deg, hsl(38 70% 97%), hsl(36 52% 88%));

    /* “Flat” fallback (useful for elements that cannot handle gradients well) */
    --app-bg-flat: hsl(36 52% 88%);

    --app-bg: var(--bg-app);
    --page-bg: var(--app-bg);

    /* Map filter (warm, subtle) */
    --filter-map: sepia(0.22) saturate(0.96) brightness(1.02) contrast(1.03) hue-rotate(-12deg);
    --map-filter: var(--filter-map);

    /* ================================
       Status / Semantic Badges
       ================================ */
    --success: hsl(146 45% 36%);
    --success-soft: hsla(146 45% 36% / 0.14);
    --info: hsl(210 60% 38%);
    --info-soft: hsla(210 60% 38% / 0.12);
    --warning: hsl(38 84% 44%);
    --warning-soft: hsla(38 84% 44% / 0.14);

    /* =========================================================
       Legacy / Component Tokens (compat)
       ========================================================= */
    --text-color: var(--text-body);
    --text-soft: color-mix(in oklab, var(--text-body) 78%, transparent);
    --text-strong: var(--text-heading);

    --card-bg: var(--surface-1);
    --card-shadow: var(--elev-2);
    --card-border: var(--border-1);

    --chip-bg: var(--surface-3);
    --chip-color: var(--text-muted);
    --chip-shadow: var(--elev-1);
    --chip-hover-shadow: 0 12px 30px hsla(26 45% 18% / 0.18);

    --input-bg: hsl(38 58% 90%);
    --input-shadow: 0 5px 12px hsla(26 45% 18% / 0.14);

    --button-bg: var(--accent-soft);
    --button-hover-bg: var(--accent-soft-hover);
    --button-text-color: var(--on-accent);

    --toast-bg: hsla(var(--accent-h) 50% 22% / 0.96);

    --header-bg-top: hsl(38 62% 93%);
    --header-bg-bottom: hsl(36 56% 88%);
    --header-shadow: var(--elev-3);
    --header-text-color: var(--text-heading);

    --header-tagline-bg: hsla(34 56% 90% / 0.92);
    --header-tagline-color: color-mix(in oklab, var(--text-heading) 86%, transparent);
    --header-tagline-shadow: var(--elev-2);

    --header-icon-bg: radial-gradient(
      circle at 30% 20%,
      hsl(30 80% 90%) 0%,
      hsl(28 72% 78%) 45%,
      hsl(26 70% 62%) 100%
    );
    --header-icon-shadow: var(--elev-1);
    --header-icon-border: var(--border-2);

    --language-pill-bg: hsla(34 56% 92% / 0.92);
    --language-pill-shadow: var(--elev-1);

    --sidebar-bg: hsl(38 42% 88%);
    --sidebar-section-bg: var(--surface-1);
    --sidebar-section-shadow: var(--elev-2);
    --sidebar-section-border: var(--border-1);

    --bottom-nav-backdrop: hsla(var(--accent-h) 44% 78% / 0.52);
    --bottom-nav-item-bg: var(--surface-1);
    --bottom-nav-item-color: color-mix(in oklab, var(--text-body) 82%, transparent);
    --bottom-nav-item-active-bg: var(--accent-solid);
    --bottom-nav-item-active-color: #ffffff;

    --map-card-bg: var(--surface-2);
    --map-card-shadow: var(--elev-3);
    --map-card-border: hsla(30 30% 18% / 0.20);

    --shadow-soft: var(--elev-1);
    --shadow-strong: var(--elev-2);

    --radius-circle-stroke: hsla(var(--accent-h) 74% 48% / 0.60);
    --radius-circle-fill: hsla(var(--accent-h) 74% 48% / 0.13);

    --cta-fg: var(--on-accent-solid);
    --cta-bg: var(--accent-solid);
    --cta-bg-hover: var(--accent-solid-dark);
  }
}

/* =========================================================
   TOKENS — Dark Overrides
   ========================================================= */
@layer tokens {
  :where(:root, html, body)[data-theme="dark"],
  [data-theme="dark"] {
    /* Text (warm off-white; less “icy” than pure white) */
    --text-3: hsl(32 100% 96%);
    --text-1: hsla(32 100% 96% / 0.92);
    --text-2: hsla(215 18% 82% / 0.74);

    --text-heading: var(--text-3);
    --text-body: var(--text-1);
    --text-muted: var(--text-2);

    --text-color: var(--text-body);
    --text-soft: color-mix(in oklab, var(--text-body) 76%, transparent);
    --text-strong: var(--text-heading);

    --placeholder-color: color-mix(in oklab, var(--text-muted) 92%, transparent);

    /* Surfaces */
    --surface-0: hsl(228 50% 6%);
    --surface-1: hsla(222 40% 10% / 0.92);
    --surface-2: hsla(222 38% 13% / 0.92);
    --surface-3: hsla(222 34% 16% / 0.92);

    /* Borders */
    --border-1: hsla(0 0% 100% / 0.08);
    --border-2: hsla(0 0% 100% / 0.14);

    /* Elevation */
    --elev-1: 0 8px 22px hsla(0 0% 0% / 0.55);
    --elev-2: 0 16px 46px hsla(0 0% 0% / 0.62);
    --elev-3: 0 24px 70px hsla(0 0% 0% / 0.70);

    /* Focus ring */
    --focus-inner: rgba(2, 6, 23, 0.88);
    --focus-outer: hsla(var(--accent-h) 74% 54% / 0.34);
    --focus-ring: 0 0 0 2px var(--focus-inner), 0 0 0 5px var(--focus-outer);
    --focus-ring-default: var(--focus-ring);

    /* Background */
    --bg-app:
      radial-gradient(circle at 35% -10%, hsla(var(--accent-h) 78% 54% / 0.16), transparent 55%),
      radial-gradient(circle at 90% 20%, hsla(34 80% 66% / 0.06), transparent 50%),
      linear-gradient(180deg, hsl(228 50% 6%), hsl(229 60% 5%));

    --app-bg-flat: hsl(228 50% 6%);

    --app-bg: var(--bg-app);
    --page-bg: var(--app-bg);

    /* Accent */
    --accent: hsl(var(--accent-h) 72% 52%);
    --accent-light: hsl(var(--accent-h) 72% 64%);
    --accent-dark: hsl(var(--accent-h) 72% 42%);

    --accent-solid: hsl(var(--accent-h) 74% 41%);
    --accent-solid-dark: hsl(var(--accent-h) 76% 34%);
    --accent-solid-light: hsl(var(--accent-h) 70% 52%);
    --on-accent-solid: #ffffff;

    --accent-soft: hsla(var(--accent-h) 72% 50% / 0.18);
    --accent-soft-hover: hsla(var(--accent-h) 72% 50% / 0.24);

    /* Map filter (dark: slight desat + dim) */
    --filter-map: grayscale(0.32) sepia(0.22) brightness(0.82) contrast(1.05) saturate(0.92) hue-rotate(-14deg);
    --map-filter: var(--filter-map);

    /* Legacy / component wiring */
    --card-bg: var(--surface-1);
    --card-shadow: var(--elev-2);
    --card-border: var(--border-1);

    --chip-bg: var(--surface-3);
    --chip-color: hsla(32 100% 96% / 0.86);
    --chip-shadow: var(--elev-1);
    --chip-hover-shadow: var(--elev-2);

    --input-bg: var(--surface-2);
    --input-shadow: var(--elev-1);

    --button-bg: var(--accent-soft);
    --button-hover-bg: var(--accent-soft-hover);
    --button-text-color: hsl(32 100% 96%);

    --toast-bg: hsla(222 40% 10% / 0.96);

    --header-bg-top: hsl(228 45% 8%);
    --header-bg-bottom: hsl(228 50% 6%);
    --header-shadow: var(--elev-3);
    --header-text-color: var(--on-dark);

    --header-tagline-bg: linear-gradient(
      135deg,
      hsla(var(--accent-h) 72% 54% / 0.88),
      hsla(34 80% 52% / 0.84)
    );
    --header-tagline-color: hsl(24 45% 14%);
    --header-tagline-shadow: var(--elev-2);

    --header-icon-bg: radial-gradient(
      circle at 30% 20%,
      hsla(222 40% 14% / 0.95) 0%,
      hsla(228 50% 6% / 0.98) 55%,
      hsla(228 50% 6% / 0.98) 100%
    );
    --header-icon-shadow: var(--elev-1);
    --header-icon-border: var(--border-2);

    --language-pill-bg: var(--surface-3);
    --language-pill-shadow: var(--elev-1);

    --sidebar-bg: var(--surface-0);
    --sidebar-section-bg: var(--surface-1);
    --sidebar-section-shadow: var(--elev-2);
    --sidebar-section-border: var(--border-1);

    --bottom-nav-backdrop: hsla(222 40% 10% / 0.92);
    --bottom-nav-item-bg: var(--surface-3);
    --bottom-nav-item-color: hsla(32 100% 96% / 0.78);
    --bottom-nav-item-active-bg: var(--accent-solid);
    --bottom-nav-item-active-color: #ffffff;

    --map-card-bg: var(--surface-0);
    --map-card-shadow: var(--elev-3);
    --map-card-border: var(--border-1);

    --radius-circle-stroke: hsla(var(--accent-h) 72% 64% / 0.70);
    --radius-circle-fill: hsla(var(--accent-h) 72% 64% / 0.14);

    --cta-fg: var(--on-accent-solid);
    --cta-bg: var(--accent-solid);
    --cta-bg-hover: var(--accent-solid-dark);
  }
}

/* =========================================================
   OS Preference Fallback (only if no manual theme set)
   ========================================================= */
@layer overrides {
  @media (prefers-color-scheme: dark) {
    :root:not([data-theme]) {
      color-scheme: dark;
    }
  }

  @media (prefers-color-scheme: light) {
    :root:not([data-theme]) {
      color-scheme: light;
    }
  }

  /* Prefer more contrast: strengthen borders slightly */
  @media (prefers-contrast: more) {
    :root {
      --border-1: hsla(30 30% 18% / 0.22);
      --border-2: hsla(30 30% 18% / 0.32);
    }

    :where(:root, html, body)[data-theme="dark"],
    [data-theme="dark"] {
      --border-1: hsla(0 0% 100% / 0.12);
      --border-2: hsla(0 0% 100% / 0.20);
    }
  }

  /* Forced Colors */
  @media (forced-colors: active) {
    :root {
      --focus-ring: 0 0 0 2px Highlight;
      --focus-ring-default: var(--focus-ring);
    }
  }
}