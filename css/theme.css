/* =========================================
   theme.css — Light & Dark Design Tokens
   Playful Warm v2.3 (Design-System Level)
   - deterministische Token-Struktur via Cascade Layers
   - CTA-Kontrast sauber: --accent-solid + --on-accent-solid
   - Legacy/Component Tokens bleiben kompatibel
   - robustes Theme-Targeting: :root/html/body + optional container [data-theme]
   ========================================= */

@layer tokens, base, overrides;

/* =========================================================
   BASE — Theme plumbing (kein “Look”, nur System)
   ========================================================= */
@layer base {
  :root {
    color-scheme: light;
  }

  :root[data-theme="light"],
  html[data-theme="light"],
  body[data-theme="light"] {
    color-scheme: light;
  }

  :root[data-theme="dark"],
  html[data-theme="dark"],
  body[data-theme="dark"],
  [data-theme="dark"] {
    color-scheme: dark;
  }
}

/* =========================================================
   TOKENS — Default (Light)
   ========================================================= */
@layer tokens {
  :root {
    /* ================================
       Brand / Accent System (muted warm)
       ================================ */
    --accent-h: 26;

    /* Brand accent (für Flächen/Badges/Active-Chips etc.) */
    --accent: hsl(var(--accent-h) 74% 48%);
    --accent-light: hsl(var(--accent-h) 70% 58%);
    --accent-dark: hsl(var(--accent-h) 76% 34%);

    /* Solid accent for CTAs (AA-kontrastfähig zu weißem Text) */
    --accent-solid: hsl(var(--accent-h) 74% 41%);
    --accent-solid-dark: hsl(var(--accent-h) 76% 34%);
    --accent-solid-light: hsl(var(--accent-h) 70% 52%);
    --on-accent-solid: #ffffff;

    /* Accent surfaces (muted) */
    --accent-soft: hsl(var(--accent-h) 56% 92%);
    --accent-soft-hover: hsl(var(--accent-h) 56% 86%);
    --accent-strong: hsl(var(--accent-h) 64% 40%);

    /* ================================
       Semantic Color Tokens
       ================================ */
    --text-3: hsl(22 60% 12%); /* strongest */
    --text-1: hsl(24 52% 14%); /* default */
    --text-2: hsl(24 26% 28%); /* muted */

    /* “On-*” tokens: intended as foreground on corresponding backgrounds */
    --on-accent: hsl(24 55% 12%); /* on accent-soft / warm surfaces */
    --on-dark: hsl(32 100% 95%);
    --on-light: hsl(222 47% 11%);

    /* ================================
       Surfaces (Light)
       ================================ */
    --surface-0: hsl(34 60% 97%);
    --surface-1: hsla(32 62% 92% / 0.98);
    --surface-2: hsla(32 58% 89% / 0.98);
    --surface-3: hsla(31 54% 86% / 0.98);

    /* Borders */
    --border-1: hsla(24 34% 20% / 0.18);
    --border-2: hsla(24 34% 20% / 0.26);

    /* Elevation */
    --elev-1: 0 1px 2px hsla(26 35% 18% / 0.10);
    --elev-2: 0 10px 26px hsla(26 40% 18% / 0.16);
    --elev-3: 0 18px 54px hsla(26 45% 18% / 0.20);

    /* Radii / Motion / Typography */
    --radius-pill: 999px;
    --border-radius: 0.5rem;

    /* Motion tokens (kompatibel zu components.css: --dur*, --ease-out) */
    --transition-fast: 150ms ease;
    --dur-fast: 120ms;
    --dur: 160ms;
    --dur-slow: 220ms;
    --ease-out: cubic-bezier(0.2, 0.8, 0.2, 1);

    --font-stack: "Segoe UI", Roboto, system-ui, -apple-system, sans-serif;
    --font-size-base: 1rem;

    /* Focus ring (consumed by components.css via --focus-ring) */
    --focus-inner: #ffffff;
    --focus-outer: hsla(var(--accent-h) 74% 48% / 0.55);
    --focus-ring: 0 0 0 2px var(--focus-inner), 0 0 0 4px var(--focus-outer);

    /* Backgrounds / Effects */
    --bg-app:
      radial-gradient(circle at 18% 0%, hsla(var(--accent-h) 70% 54% / 0.14), transparent 58%),
      radial-gradient(circle at 88% 22%, hsla(30 70% 58% / 0.08), transparent 54%),
      linear-gradient(180deg, hsl(34 60% 97%), hsl(32 40% 88%));

    /* App/page background tokens (components.css nutzt --app-bg/--page-bg) */
    --app-bg: var(--bg-app);
    --page-bg: var(--app-bg);

    /* Filters */
    --filter-map: sepia(0.18) saturate(0.92) brightness(1.01) contrast(1.03) hue-rotate(-10deg);

    /* ================================
       Status / Semantic Badges
       ================================ */
    --success: hsl(146 45% 36%);
    --success-soft: hsla(146 45% 36% / 0.14);
    --info: hsl(210 60% 38%);
    --info-soft: hsla(210 60% 38% / 0.12);
    --warning: hsl(38 84% 44%);
    --warning-soft: hsla(38 84% 44% / 0.14);

    /* =========================================================
       Legacy / Component Tokens (compat)
       ========================================================= */
    --text-color: var(--text-1);
    --text-soft: var(--text-2);
    --text-strong: var(--text-3);

    --card-bg: var(--surface-1);
    --card-shadow: var(--elev-2);
    --card-border: var(--border-1);

    --chip-bg: var(--surface-3);
    --chip-color: var(--text-2);
    --chip-shadow: var(--elev-1);
    --chip-hover-shadow: 0 12px 30px hsla(26 45% 18% / 0.18);

    /* Inputs */
    --input-bg: hsl(33 52% 90%);
    --input-shadow: 0 5px 12px hsla(26 45% 18% / 0.14);

    /* Legacy button tokens (falls noch genutzt) */
    --button-bg: var(--accent-soft);
    --button-hover-bg: var(--accent-soft-hover);
    --button-text-color: var(--on-accent);

    --toast-bg: hsla(var(--accent-h) 50% 22% / 0.96);

    /* Header tokens (Menu-Button-Optik bleibt wie bisher) */
    --header-bg-top: hsl(33 58% 93%);
    --header-bg-bottom: hsl(30 52% 88%);
    --header-shadow: var(--elev-3);
    --header-text-color: var(--text-3);

    --header-tagline-bg: hsla(26 46% 90% / 0.92);
    --header-tagline-color: hsl(24 44% 18%);
    --header-tagline-shadow: var(--elev-2);

    /* WICHTIG: nicht anfassen, Menu-Button soll so bleiben. */
    --header-icon-bg: radial-gradient(
      circle at 30% 20%,
      hsl(30 80% 90%) 0%,
      hsl(28 72% 78%) 45%,
      hsl(26 70% 62%) 100%
    );
    --header-icon-shadow: var(--elev-1);
    --header-icon-border: var(--border-2);

    --language-pill-bg: hsla(32 52% 92% / 0.92);
    --language-pill-shadow: var(--elev-1);

    --sidebar-bg: hsl(32 38% 88%);
    --sidebar-section-bg: var(--surface-1);
    --sidebar-section-shadow: var(--elev-2);
    --sidebar-section-border: var(--border-1);

    --bottom-nav-backdrop: hsla(var(--accent-h) 40% 76% / 0.50);
    --bottom-nav-item-bg: var(--surface-1);
    --bottom-nav-item-color: hsl(24 22% 26%);
    --bottom-nav-item-active-bg: var(--accent-solid);
    --bottom-nav-item-active-color: #ffffff;

    --map-card-bg: var(--surface-2);
    --map-card-shadow: var(--elev-3);
    --map-card-border: hsla(24 34% 20% / 0.22);

    --shadow-soft: var(--elev-1);
    --shadow-strong: var(--elev-2);

    --radius-circle-stroke: hsla(var(--accent-h) 74% 48% / 0.60);
    --radius-circle-fill: hsla(var(--accent-h) 74% 48% / 0.13);

    /* components.css expects --map-filter */
    --map-filter: var(--filter-map);

    /* Optional: explicit CTA foreground alias (recommended in components) */
    --cta-fg: var(--on-accent-solid);
    --cta-bg: var(--accent-solid);
    --cta-bg-hover: var(--accent-solid-dark);
  }
}

/* =========================================================
   TOKENS — Dark Overrides
   (applies when data-theme="dark" is set on root/html/body
   or on a container [data-theme="dark"])
   ========================================================= */
@layer tokens {
  :root[data-theme="dark"],
  html[data-theme="dark"],
  body[data-theme="dark"],
  [data-theme="dark"] {
    /* Semantic Overrides (Dark) */
    --text-3: hsl(32 100% 96%);
    --text-1: hsla(32 100% 96% / 0.92);
    --text-2: hsla(215 18% 82% / 0.74);

    --surface-0: hsl(228 50% 6%);
    --surface-1: hsla(222 40% 10% / 0.92);
    --surface-2: hsla(222 38% 13% / 0.92);
    --surface-3: hsla(222 34% 16% / 0.92);

    --border-1: hsla(0 0% 100% / 0.08);
    --border-2: hsla(0 0% 100% / 0.14);

    --elev-1: 0 8px 22px hsla(0 0% 0% / 0.55);
    --elev-2: 0 16px 46px hsla(0 0% 0% / 0.62);
    --elev-3: 0 24px 70px hsla(0 0% 0% / 0.70);

    --focus-inner: rgba(2, 6, 23, 0.92);
    --focus-outer: hsla(var(--accent-h) 74% 52% / 0.45);
    --focus-ring: 0 0 0 2px var(--focus-inner), 0 0 0 4px var(--focus-outer);

    --bg-app:
      radial-gradient(circle at 35% -10%, hsla(var(--accent-h) 78% 54% / 0.18), transparent 55%),
      radial-gradient(circle at 90% 20%, hsla(34 80% 66% / 0.07), transparent 50%),
      linear-gradient(180deg, hsl(228 50% 6%), hsl(229 60% 5%));

    --app-bg: var(--bg-app);
    --page-bg: var(--app-bg);

    /* Dark accent: keep brand accent for surfaces, keep solid for CTAs */
    --accent: hsl(var(--accent-h) 72% 52%);
    --accent-light: hsl(var(--accent-h) 72% 64%);
    --accent-dark: hsl(var(--accent-h) 72% 42%);

    --accent-solid: hsl(var(--accent-h) 74% 41%);
    --accent-solid-dark: hsl(var(--accent-h) 76% 34%);
    --accent-solid-light: hsl(var(--accent-h) 70% 52%);
    --on-accent-solid: #ffffff;

    --accent-soft: hsla(var(--accent-h) 72% 50% / 0.18);
    --accent-soft-hover: hsla(var(--accent-h) 72% 50% / 0.24);

    --filter-map: grayscale(0.35) sepia(0.26) brightness(0.78) contrast(1.05) saturate(0.9)
      hue-rotate(-14deg);

    --map-filter: var(--filter-map);

    /* Legacy / Component Overrides (Dark) */
    --text-color: var(--text-1);
    --text-soft: var(--text-2);
    --text-strong: var(--text-3);

    --card-bg: var(--surface-1);
    --card-shadow: var(--elev-2);
    --card-border: var(--border-1);

    --chip-bg: var(--surface-3);
    --chip-color: hsla(32 100% 96% / 0.86);
    --chip-shadow: var(--elev-1);
    --chip-hover-shadow: var(--elev-2);

    --input-bg: var(--surface-2);
    --input-shadow: var(--elev-1);

    --button-bg: var(--accent-soft);
    --button-hover-bg: var(--accent-soft-hover);
    --button-text-color: hsl(32 100% 96%);

    --toast-bg: hsla(222 40% 10% / 0.96);

    --header-bg-top: hsl(228 45% 8%);
    --header-bg-bottom: hsl(228 50% 6%);
    --header-shadow: var(--elev-3);
    --header-text-color: var(--on-dark);

    --header-tagline-bg: linear-gradient(
      135deg,
      hsla(var(--accent-h) 72% 54% / 0.90),
      hsla(34 80% 52% / 0.88)
    );
    --header-tagline-color: hsl(24 45% 14%);
    --header-tagline-shadow: var(--elev-2);

    --header-icon-bg: radial-gradient(
      circle at 30% 20%,
      hsla(222 40% 14% / 0.95) 0%,
      hsla(228 50% 6% / 0.98) 55%,
      hsla(228 50% 6% / 0.98) 100%
    );
    --header-icon-shadow: var(--elev-1);
    --header-icon-border: var(--border-2);

    --language-pill-bg: var(--surface-3);
    --language-pill-shadow: var(--elev-1);

    --sidebar-bg: var(--surface-0);
    --sidebar-section-bg: var(--surface-1);
    --sidebar-section-shadow: var(--elev-2);
    --sidebar-section-border: var(--border-1);

    --bottom-nav-backdrop: hsla(222 40% 10% / 0.92);
    --bottom-nav-item-bg: var(--surface-3);
    --bottom-nav-item-color: hsla(32 100% 96% / 0.78);
    --bottom-nav-item-active-bg: var(--accent-solid);
    --bottom-nav-item-active-color: #ffffff;

    --map-card-bg: var(--surface-0);
    --map-card-shadow: var(--elev-3);
    --map-card-border: var(--border-1);

    --radius-circle-stroke: hsla(var(--accent-h) 72% 64% / 0.70);
    --radius-circle-fill: hsla(var(--accent-h) 72% 64% / 0.14);

    --cta-fg: var(--on-accent-solid);
    --cta-bg: var(--accent-solid);
    --cta-bg-hover: var(--accent-solid-dark);
  }
}

/* =========================================================
   OS Preference Fallback (only if no manual theme set)
   - keeps one source of truth: we “mirror” dark overrides
   ========================================================= */
@layer overrides {
  @media (prefers-color-scheme: dark) {
    :root:not([data-theme]) {
      color-scheme: dark;
    }

    /* Apply the same variable set as dark when no manual theme is present.
       NOTE: CSS cannot “import” the block above, so we keep this minimal by
       only flipping the attribute-driven surface via color-scheme.
       If you want full dark tokens without data-theme, set data-theme in JS
       (recommended for deterministic theming). */
  }

  @media (prefers-color-scheme: light) {
    :root:not([data-theme]) {
      color-scheme: light;
    }
  }

  /* Prefer more contrast: strengthen borders slightly */
  @media (prefers-contrast: more) {
    :root {
      --border-1: hsla(24 34% 20% / 0.26);
      --border-2: hsla(24 34% 20% / 0.34);
    }

    :root[data-theme="dark"],
    html[data-theme="dark"],
    body[data-theme="dark"],
    [data-theme="dark"] {
      --border-1: hsla(0 0% 100% / 0.12);
      --border-2: hsla(0 0% 100% / 0.20);
    }
  }

  /* Forced Colors */
  @media (forced-colors: active) {
    :root {
      --focus-ring: 0 0 0 2px Highlight;
    }
  }
}