/* styles.css — Entry / Aggregator (layered, deterministic cascade)
   ---------------------------------------------------------
   Cache Busting (GitHub Pages / iOS Safari):
   - Wenn Änderungen “nicht greifen”: erhöhe die Zahl in ?v=...
   --------------------------------------------------------- */

@layer tokens, base, components, utilities, overrides;

/* 1) Design-Variablen / Semantische Tokens (Light/Dark) */
@import url("./theme.css?v=20251222");

/* 2) Reset, Body, Typografie, Grundlayout (muss selbst @layer base nutzen!) */
@import url("./base.css?v=20251222");

/* 3) Komponenten, Layout, Map, Sidebar, Toast, Onboarding etc. */
@import url("./components.css?v=20251222");

/* 4) Badges (badges.css sollte in @layer components stehen!) */
@import url("./badges.css?v=20251222");

/* 5) Utilities / Hilfsklassen (.hidden, .sr-only, etc.) */
@import url("./utilities.css?v=20251222");


/* =========================================================
   GLOBAL OVERRIDES / FIXES (layered)
   - nur hier global “nachziehen”
   - vermeidet unlayered Override-Fallen
   ========================================================= */
@layer overrides {
  /* Einheitliche Textfarbe für Sidebar-Titel (inkl. <details>/<summary>) */
  .sidebar-section-title {
    color: var(--text-heading, var(--text-strong, var(--text-color, #111827))) !important;
    opacity: 1 !important;
  }

  /* Helper-/Muted-Texte konsistent */
  .filter-group-helper,
  .filter-summary,
  .daylog-last-saved,
  .plus-note {
    color: var(--text-muted, var(--text-soft, rgba(107, 114, 128, 0.95)));
  }

  /* Header im Light-Theme wärmer (Dark bleibt aus tokens) */
  html[data-theme="light"] .app-header {
    background:
      radial-gradient(900px 420px at 18% -10%,
        rgba(243, 162, 58, 0.32) 0%,
        rgba(243, 162, 58, 0.00) 60%),
      linear-gradient(180deg,
        #FFF7EE 0%,
        #FFE7D1 55%,
        #F6C79D 100%);
    border-bottom: 1px solid rgba(243, 162, 58, 0.18);
  }

  /* UI Fix: „Nur Karte“ Toggle im Spots-Header entfernen (bleibt im Menü nutzbar) */
  #btn-toggle-view {
    display: none !important;
  }

  /* Bottom Nav entfernen + Platz zurückholen (wenn du sie nicht mehr nutzt) */
  :root {
    --bottom-nav-height: 0px;
    --bottom-nav-safearea: 0px;
  }

  .bottom-nav {
    display: none !important;
  }

  /* Wenn components.css unten Padding reserviert, wieder neutralisieren */
  .app-main {
    padding-bottom: calc(16px + env(safe-area-inset-bottom, 0px)) !important;
  }

  /* ---------------------------------------------------------
     Details/Summary Angleichen (Plus / Mein Tag)
     - sorgt dafür, dass <details.sidebar-section> exakt wie <section.sidebar-section> wirkt
     --------------------------------------------------------- */
  details.sidebar-section {
    background: var(--sidebar-section-bg, var(--card-bg, var(--surface-1)));
    border: 1px solid var(--sidebar-section-border, var(--card-border, var(--border-1, rgba(0,0,0,0.08))));
    box-shadow: var(--sidebar-section-shadow, var(--card-shadow, var(--elev-2, 0 10px 26px rgba(0,0,0,0.16))));
    border-radius: 20px;
    overflow: hidden;
  }

  details.sidebar-section > summary {
    list-style: none;
    cursor: pointer;
  }

  details.sidebar-section > summary::-webkit-details-marker {
    display: none;
  }

  details.sidebar-section > summary.sidebar-section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;

    padding: 10px 14px;
    margin: 0;

    background: transparent;
    border: 0;
  }

  details.sidebar-section > :not(summary) {
    padding: 12px 14px 14px;
  }

  details.sidebar-section:not([open]) > :not(summary) {
    padding-top: 0;
  }

  /* iOS/Safari: Summary-Fokus sauber (kein UA-Rechteck) */
  summary.sidebar-section-header:focus,
  summary.sidebar-section-header:focus-visible {
    outline: none !important;
  }

  summary.sidebar-section-header:focus-visible {
    border-radius: 18px;
    box-shadow: var(--focus-ring, var(--focus-ring-default)) !important;
  }

  /* App-Menü (☰) nur stylen, wenn es offen ist (verhindert „unsichtbares Overlay“) */
  #app-menu.app-menu:not([hidden]) {
    position: fixed;
    inset: 0;
    z-index: 9999;

    display: flex;
    align-items: flex-start;
    justify-content: center;

    padding-top: max(14px, env(safe-area-inset-top));
    padding-left: 12px;
    padding-right: 12px;
    padding-bottom: max(14px, env(safe-area-inset-bottom));
  }

  #app-menu.app-menu:not([hidden]) .app-menu-backdrop {
    position: absolute;
    inset: 0;
  }

  #app-menu.app-menu:not([hidden]) .app-menu-panel {
    position: relative;

    width: min(520px, 100%);
    height: auto !important;

    min-height: 0 !important;
    max-height: calc(100dvh - 28px - env(safe-area-inset-top) - env(safe-area-inset-bottom)) !important;

    overflow: auto !important;
    -webkit-overflow-scrolling: touch;

    border-radius: 24px;
    background: var(--card-bg, var(--surface-1, rgba(255,255,255,0.98)));
    border: 1px solid var(--card-border, var(--border-1, rgba(0,0,0,0.08)));
    box-shadow: var(--elevation-lg, 0 10px 24px rgba(15, 23, 42, 0.22));
  }

  #app-menu.app-menu:not([hidden]) .app-menu-languages {
    margin-top: 12px !important;
  }
}